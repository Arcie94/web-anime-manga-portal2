---
import Layout from "../layouts/Layout.astro";
---

<Layout title="Daftar - AnimePlay">
  <!-- Back Button -->
  <div class="fixed top-4 left-4 z-50">
    <button
      onclick="history.length > 1 ? history.back() : window.location.href = '/'"
      class="w-10 h-10 md:w-12 md:h-12 flex items-center justify-center rounded-full bg-black/50 hover:bg-black/70 text-white border border-white/10 transition-all hover:scale-110 active:scale-95 backdrop-blur-sm"
      aria-label="Kembali"
    >
      <svg
        xmlns="http://www.w3.org/2000/svg"
        fill="none"
        viewBox="0 0 24 24"
        stroke-width="2.5"
        stroke="currentColor"
        class="w-5 h-5 md:w-6 md:h-6"
      >
        <path
          stroke-linecap="round"
          stroke-linejoin="round"
          d="M10.5 19.5 3 12m0 0 7.5-7.5M3 12h18"></path>
      </svg>
    </button>
  </div>
  <div class="max-w-md mx-auto py-20">
    <div class="bg-gray-800 p-8 rounded-xl shadow-2xl border border-gray-700">
      <h1
        class="text-3xl font-bold text-center mb-8 bg-clip-text text-transparent bg-gradient-to-r from-pink-500 to-violet-500"
      >
        Daftar Akun
      </h1>

      <form id="registerForm" class="space-y-6">
        <div>
          <label class="block text-sm font-medium text-gray-400 mb-2"
            >Username</label
          >
          <input
            type="text"
            name="username"
            required
            class="w-full bg-gray-900 border border-gray-600 rounded-lg px-4 py-3 focus:outline-none focus:border-pink-500"
          />
        </div>

        <div>
          <label class="block text-sm font-medium text-gray-400 mb-2"
            >Password</label
          >
          <input
            type="password"
            name="password"
            required
            class="w-full bg-gray-900 border border-gray-600 rounded-lg px-4 py-3 focus:outline-none focus:border-pink-500"
          />
        </div>

        <button
          type="submit"
          class="w-full bg-gradient-to-r from-pink-600 to-violet-600 hover:from-pink-700 hover:to-violet-700 text-white font-bold py-3 rounded-lg transition-all transform hover:scale-[1.02]"
        >
          Daftar
        </button>
      </form>

      <p class="mt-6 text-center text-gray-400">
        Sudah punya akun? <a
          href="/login"
          class="text-pink-400 hover:text-pink-300">Login</a
        >
      </p>
    </div>
  </div>
</Layout>

<script>
  const form = document.getElementById("registerForm") as HTMLFormElement;
  form?.addEventListener("submit", async (e) => {
    e.preventDefault();
    const formData = new FormData(form);
    const data = Object.fromEntries(formData);

    try {
      const res = await fetch("http://localhost:3000/api/auth/register", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(data),
      });

      const result = await res.json();
      if (res.ok) {
        alert("Registrasi Berhasil! Silakan Login.");
        window.location.href = "/login";
      } else {
        alert(result.error || "Registrasi Gagal");
      }
    } catch (err) {
      alert("Terjadi kesalahan koneksi");
    }
  });
</script>
