---
import Layout from "../layouts/Layout.astro";
import HeroCarousel from "../components/HeroCarousel";
import ContentRow from "../components/ContentRow";
import CategoryRow from "../components/CategoryRow";
import { apiFetch } from "../lib/api";
import { FEATURED_MANGA } from "../data/featuredManga";

export const prerender = false;

// Fetch homepage data from Sankavollerei Comic API
let trendingManga: any[] = [];
let ongoingManga: any[] = [];

try {
  const homeData = await apiFetch<{
    data: { trending: any[]; ongoing: any[] };
  }>("/manga/home");

  if (homeData?.data) {
    trendingManga = homeData.data.trending || [];
    ongoingManga = homeData.data.ongoing || [];
  }
} catch (error) {
  console.error("Failed to fetch manga home data:", error);
}
---

<Layout title="AnimePlay - Read Manga Online">
  {/* Hero Carousel */}
  <div class="relative z-0">
    <HeroCarousel featured={FEATURED_MANGA} client:only="react" />
  </div>

  {/* Sub-Header Categories */}
  <CategoryRow client:visible />

  {/* Content Rows */}
  <ContentRow
    title="Trending Manga"
    endpoint="/manga/trending"
    dataKey="mangaList"
    type="manga"
    client:load
  />

  <ContentRow
    title="Ongoing Manga"
    endpoint="/manga/ongoing"
    dataKey="mangaList"
    type="manga"
    client:load
  />

  {/* Genre Sections */}
  <ContentRow
    title="Action Manga"
    endpoint="/manga/genres/Action"
    dataKey="mangaList"
    type="manga"
    client:visible
  />
  <ContentRow
    title="Romance Manga"
    endpoint="/manga/genres/Romance"
    dataKey="mangaList"
    type="manga"
    client:visible
  />
  <ContentRow
    title="Drama Manga"
    endpoint="/manga/genres/Drama"
    dataKey="mangaList"
    type="manga"
    client:visible
  />
  <ContentRow
    title="Fantasy Manga"
    endpoint="/manga/genres/Fantasy"
    dataKey="mangaList"
    type="manga"
    client:visible
  />
</Layout>
